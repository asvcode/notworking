---

title: pre_processing


keywords: fastai
sidebar: home_sidebar

summary: "processing"
description: "processing"
nb_path: "03_preprocessing.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 03_preprocessing.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/notworking/images/graphic8.PNG" alt="preprocessing"></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Mask-&amp;-Save">Mask &amp; Save<a class="anchor-link" href="#Mask-&amp;-Save"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='View Mask &amp; Save tutorial on Kaggle (click on Kaggle icon)' %}
<a href="https://www.kaggle.com/avirdee/mask-and-save-tutorial/"><img src="images/kaggle.PNG" alt="kaggle"></a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mask_and_save_path" class="doc_header"><code>mask_and_save_path</code><a href="https://github.com/asvcode/notworking/tree/master/notworking/preprocessing.py#L13" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mask_and_save_path</code>(<strong><code>file</code></strong>:<code>L</code>, <strong><code>source</code></strong>=<em><code>None</code></em>, <strong><code>show</code></strong>=<em><code>False</code></em>, <strong><code>window</code></strong>=<em><code>(1500, -600)</code></em>, <strong><code>sigma</code></strong>:<code>float</code>=<em><code>0.1</code></em>, <strong><code>thresh</code></strong>:<code>float</code>=<em><code>0.9</code></em>, <strong><code>save</code></strong>=<em><code>False</code></em>, <strong><code>save_path</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Helper to create masks based on dicom window with the option to save the updated image from path</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mask_and_save_df" class="doc_header"><code>mask_and_save_df</code><a href="https://github.com/asvcode/notworking/tree/master/notworking/preprocessing.py#L40" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mask_and_save_df</code>(<strong><code>file</code></strong>:<code>DataFrame</code>, <strong><code>source</code></strong>=<em><code>None</code></em>, <strong><code>show</code></strong>=<em><code>False</code></em>, <strong><code>window</code></strong>=<em><code>(1500, -600)</code></em>, <strong><code>sigma</code></strong>:<code>float</code>=<em><code>0.1</code></em>, <strong><code>thresh</code></strong>:<code>float</code>=<em><code>0.9</code></em>, <strong><code>save</code></strong>=<em><code>False</code></em>, <strong><code>save_path</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Helper to create masks based on dicom window with the option to save the updated image from a dataframe</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>fastai</code> has a handy method <code>from.dicoms</code> that can access dicom metadata and display this in a dataframe.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m_items</span> <span class="o">=</span> <span class="n">get_dicom_files</span><span class="p">(</span><span class="s1">&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00007637202177411956430&#39;</span><span class="p">)</span>
<span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/&#39;</span>
<span class="n">dicom_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dicoms</span><span class="p">(</span><span class="n">m_items</span><span class="p">)</span>
<span class="n">dicom_dataframe</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SpecificCharacterSet</th>
      <th>ImageType</th>
      <th>SOPInstanceUID</th>
      <th>Modality</th>
      <th>Manufacturer</th>
      <th>ManufacturerModelName</th>
      <th>PatientName</th>
      <th>PatientID</th>
      <th>PatientSex</th>
      <th>DeidentificationMethod</th>
      <th>...</th>
      <th>ImageOrientationPatient3</th>
      <th>ImageOrientationPatient4</th>
      <th>ImageOrientationPatient5</th>
      <th>MultiPixelSpacing</th>
      <th>PixelSpacing1</th>
      <th>img_min</th>
      <th>img_max</th>
      <th>img_mean</th>
      <th>img_std</th>
      <th>img_pct_window</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ISO_IR 100</td>
      <td>ORIGINAL</td>
      <td>2.25.12297650151329871895440507938349160734</td>
      <td>CT</td>
      <td>GE MEDICAL SYSTEMS</td>
      <td>LightSpeed VCT</td>
      <td>(I, D, 0, 0, 0, 0, 7, 6, 3, 7, 2, 0, 2, 1, 7, 7, 4, 1, 1, 9, 5, 6, 4, 3, 0)</td>
      <td>ID00007637202177411956430</td>
      <td></td>
      <td>Table;</td>
      <td>...</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1</td>
      <td>0.652344</td>
      <td>-2000</td>
      <td>2842</td>
      <td>-1.454884</td>
      <td>1137.488858</td>
      <td>0.058094</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ISO_IR 100</td>
      <td>ORIGINAL</td>
      <td>2.25.37611372879908126511187998276199853341</td>
      <td>CT</td>
      <td>GE MEDICAL SYSTEMS</td>
      <td>LightSpeed VCT</td>
      <td>(I, D, 0, 0, 0, 0, 7, 6, 3, 7, 2, 0, 2, 1, 7, 7, 4, 1, 1, 9, 5, 6, 4, 3, 0)</td>
      <td>ID00007637202177411956430</td>
      <td></td>
      <td>Table;</td>
      <td>...</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1</td>
      <td>0.652344</td>
      <td>-2000</td>
      <td>2918</td>
      <td>19.038597</td>
      <td>1138.876560</td>
      <td>0.068130</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 67 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To see how <code>mask_and_save</code> works here are 10 original images (we can use <code>get_dicom_image</code> to view the images). To save the images in <code>png</code> format change save to <code>True</code> and set a <code>save_path</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Setting the <code>sigma</code> value to 0.1 reduces the image area only to the areas that are important</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Dicom-metadata-dict">Dicom metadata dict<a class="anchor-link" href="#Dicom-metadata-dict"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Updated <code>from_dicoms</code> method to <code>from_dicoms2</code> that allows you to choose the window setting</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Dataset.updated_dict" class="doc_header"><code>Dataset.updated_dict</code><a href="https://github.com/asvcode/notworking/tree/master/notworking/preprocessing.py#L66" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Dataset.updated_dict</code>(<strong><code>windows</code></strong>=<em><code>[(1500, -600)]</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>from_dicoms2</code> allows you to set the dicom window, for example in this case the <code>mediastinum</code> window is used</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dicom_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dicoms2</span><span class="p">(</span><span class="n">m_items</span><span class="p">,</span> <span class="n">windows</span><span class="o">=</span><span class="n">dicom_windows</span><span class="o">.</span><span class="n">mediastinum</span><span class="p">)</span>
<span class="n">dicom_dataframe</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SpecificCharacterSet</th>
      <th>ImageType</th>
      <th>SOPInstanceUID</th>
      <th>Modality</th>
      <th>Manufacturer</th>
      <th>ManufacturerModelName</th>
      <th>PatientName</th>
      <th>PatientID</th>
      <th>PatientSex</th>
      <th>DeidentificationMethod</th>
      <th>...</th>
      <th>RescaleIntercept</th>
      <th>RescaleSlope</th>
      <th>RescaleType</th>
      <th>fname</th>
      <th>img_min</th>
      <th>img_max</th>
      <th>img_mean</th>
      <th>img_std</th>
      <th>img_pct_window</th>
      <th>file_path</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ISO_IR 100</td>
      <td>[ORIGINAL, PRIMARY, AXIAL]</td>
      <td>2.25.12297650151329871895440507938349160734</td>
      <td>CT</td>
      <td>GE MEDICAL SYSTEMS</td>
      <td>LightSpeed VCT</td>
      <td>(I, D, 0, 0, 0, 0, 7, 6, 3, 7, 2, 0, 2, 1, 7, 7, 4, 1, 1, 9, 5, 6, 4, 3, 0)</td>
      <td>ID00007637202177411956430</td>
      <td></td>
      <td>Table;</td>
      <td>...</td>
      <td>-1024.0</td>
      <td>1.0</td>
      <td>HU</td>
      <td>D:\Datasets\osic-pulmonary-fibrosis-progression\train\ID00007637202177411956430\1.dcm</td>
      <td>-2000</td>
      <td>2842</td>
      <td>-1.454884</td>
      <td>1137.488858</td>
      <td>0.219498</td>
      <td>ID00007637202177411956430/1.dcm</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ISO_IR 100</td>
      <td>[ORIGINAL, PRIMARY, AXIAL]</td>
      <td>2.25.37611372879908126511187998276199853341</td>
      <td>CT</td>
      <td>GE MEDICAL SYSTEMS</td>
      <td>LightSpeed VCT</td>
      <td>(I, D, 0, 0, 0, 0, 7, 6, 3, 7, 2, 0, 2, 1, 7, 7, 4, 1, 1, 9, 5, 6, 4, 3, 0)</td>
      <td>ID00007637202177411956430</td>
      <td></td>
      <td>Table;</td>
      <td>...</td>
      <td>-1024.0</td>
      <td>1.0</td>
      <td>HU</td>
      <td>D:\Datasets\osic-pulmonary-fibrosis-progression\train\ID00007637202177411956430\10.dcm</td>
      <td>-2000</td>
      <td>2918</td>
      <td>19.038597</td>
      <td>1138.876560</td>
      <td>0.248634</td>
      <td>ID00007637202177411956430/10.dcm</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 54 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this case the <code>lungs</code> window was used</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dicom_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dicoms2</span><span class="p">(</span><span class="n">m_items</span><span class="p">,</span> <span class="n">windows</span><span class="o">=</span><span class="n">dicom_windows</span><span class="o">.</span><span class="n">lungs</span><span class="p">)</span>
<span class="n">dicom_dataframe</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SpecificCharacterSet</th>
      <th>ImageType</th>
      <th>SOPInstanceUID</th>
      <th>Modality</th>
      <th>Manufacturer</th>
      <th>ManufacturerModelName</th>
      <th>PatientName</th>
      <th>PatientID</th>
      <th>PatientSex</th>
      <th>DeidentificationMethod</th>
      <th>...</th>
      <th>RescaleIntercept</th>
      <th>RescaleSlope</th>
      <th>RescaleType</th>
      <th>fname</th>
      <th>img_min</th>
      <th>img_max</th>
      <th>img_mean</th>
      <th>img_std</th>
      <th>img_pct_window</th>
      <th>file_path</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ISO_IR 100</td>
      <td>[ORIGINAL, PRIMARY, AXIAL]</td>
      <td>2.25.12297650151329871895440507938349160734</td>
      <td>CT</td>
      <td>GE MEDICAL SYSTEMS</td>
      <td>LightSpeed VCT</td>
      <td>(I, D, 0, 0, 0, 0, 7, 6, 3, 7, 2, 0, 2, 1, 7, 7, 4, 1, 1, 9, 5, 6, 4, 3, 0)</td>
      <td>ID00007637202177411956430</td>
      <td></td>
      <td>Table;</td>
      <td>...</td>
      <td>-1024.0</td>
      <td>1.0</td>
      <td>HU</td>
      <td>D:\Datasets\osic-pulmonary-fibrosis-progression\train\ID00007637202177411956430\1.dcm</td>
      <td>-2000</td>
      <td>2842</td>
      <td>-1.454884</td>
      <td>1137.488858</td>
      <td>0.702209</td>
      <td>ID00007637202177411956430/1.dcm</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ISO_IR 100</td>
      <td>[ORIGINAL, PRIMARY, AXIAL]</td>
      <td>2.25.37611372879908126511187998276199853341</td>
      <td>CT</td>
      <td>GE MEDICAL SYSTEMS</td>
      <td>LightSpeed VCT</td>
      <td>(I, D, 0, 0, 0, 0, 7, 6, 3, 7, 2, 0, 2, 1, 7, 7, 4, 1, 1, 9, 5, 6, 4, 3, 0)</td>
      <td>ID00007637202177411956430</td>
      <td></td>
      <td>Table;</td>
      <td>...</td>
      <td>-1024.0</td>
      <td>1.0</td>
      <td>HU</td>
      <td>D:\Datasets\osic-pulmonary-fibrosis-progression\train\ID00007637202177411956430\10.dcm</td>
      <td>-2000</td>
      <td>2918</td>
      <td>19.038597</td>
      <td>1138.876560</td>
      <td>0.720448</td>
      <td>ID00007637202177411956430/10.dcm</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 54 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Move-Files">Move Files<a class="anchor-link" href="#Move-Files"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='View dicom dataframe and <a href="/notworking/preprocessing.html#move_files"><code>move_files</code></a> tutorial on Kaggle (click on Kaggle icon)' %}
<a href="https://www.kaggle.com/avirdee/dicom-dataframe-tutorial/"><img src="images/kaggle.PNG" alt="kaggle"></a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='Take note of this.' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="move_files" class="doc_header"><code>move_files</code><a href="https://github.com/asvcode/notworking/tree/master/notworking/preprocessing.py#L91" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>move_files</code>(<strong><code>df</code></strong>, <strong><code>source</code></strong>, <strong><code>save_path</code></strong>)</p>
</blockquote>
<p>helper to move files</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="dicom-convert-3channel">dicom convert 3channel<a class="anchor-link" href="#dicom-convert-3channel"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dicom_convert_3channel" class="doc_header"><code>dicom_convert_3channel</code><a href="https://github.com/asvcode/notworking/tree/master/notworking/preprocessing.py#L110" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dicom_convert_3channel</code>(<strong><code>fn</code></strong>:<code>Path'&gt;, &lt;class 'str'&gt;)</code>, <strong><code>save_dir</code></strong>:<code>str</code>, <strong><code>win1</code></strong>=<em><code>(1500, -600)</code></em>, <strong><code>win2</code></strong>=<em><code>(150, 30)</code></em>, <strong><code>win3</code></strong>=<em><code>(80, 40)</code></em>)</p>
</blockquote>
<p>Split a dicom image into 3 windows with one window per channel and saved as jpg</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To see how <code>dicom_convert_3channel works</code>, specify a save directory and choose a test file</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">save_dir</span> <span class="o">=</span> <span class="s1">&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/test3c/&#39;</span>
<span class="n">test1</span> <span class="o">=</span> <span class="n">m_items</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
<span class="n">test1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00007637202177411956430/20.dcm&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Choose 3 windows, one for each channel, in this case <code>lungs</code>, <code>mediastinum</code> and <code>pe</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dicom_convert_3channel</span><span class="p">(</span><span class="n">test1</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">,</span> <span class="n">win1</span><span class="o">=</span><span class="n">dicom_windows</span><span class="o">.</span><span class="n">lungs</span><span class="p">,</span> <span class="n">win2</span><span class="o">=</span><span class="n">dicom_windows</span><span class="o">.</span><span class="n">mediastinum</span><span class="p">,</span> <span class="n">win3</span><span class="o">=</span><span class="n">dicom_windows</span><span class="o">.</span><span class="n">pe</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Load the saved image which saves with the same name as the input image name</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">saved_image</span> <span class="o">=</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/test3c/20.jpg&#39;</span><span class="p">)</span>
<span class="n">saved_ten</span> <span class="o">=</span> <span class="n">TensorImage</span><span class="p">(</span><span class="n">saved_image</span><span class="p">)</span>
<span class="n">saved_ten</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([512, 512, 3])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Dicom-Splitter">Dicom Splitter<a class="anchor-link" href="#Dicom-Splitter"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='View dicom splitter tutorial on kaggle (click Kaggle icon)' %}
<a href="https://www.kaggle.com/avirdee/dicom-splitter-tutorial/"><img src="images/kaggle.PNG" alt="kaggle"></a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dicomsplit" class="doc_header"><code>dicomsplit</code><a href="https://github.com/asvcode/notworking/tree/master/notworking/preprocessing.py#L124" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dicomsplit</code>(<strong><code>valid_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>seed</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Splits <code>items</code> between train/val with <code>valid_pct</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="check_duplicate" class="doc_header"><code>check_duplicate</code><a href="https://github.com/asvcode/notworking/tree/master/notworking/preprocessing.py#L168" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>check_duplicate</code>(<strong><code>items</code></strong>, <strong><code>seed</code></strong>=<em><code>5</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dicom_splitter" class="doc_header"><code>dicom_splitter</code><a href="https://github.com/asvcode/notworking/tree/master/notworking/preprocessing.py#L173" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dicom_splitter</code>(<strong><code>items</code></strong>, <strong><code>valid_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>seed</code></strong>=<em><code>77</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check to see how <code>dicom_splittter</code> works.  First create a random generating function that will choose 10 random numbers between a range of 0 and the length of the number of items</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">random_</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">randomList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="n">randomList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">items</span><span class="p">[</span><span class="n">randomList</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="n">get_dicom_files</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<span class="n">rand_items</span> <span class="o">=</span> <span class="n">random_</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">rand_items</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#10) [Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00035637202182204917484/310.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00381637202299644114027/252.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00051637202185848464638/17.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00173637202238329754031/217.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00283637202278714365037/103.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00129637202219868188000/25.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00273637202271319294586/41.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00329637202285906759848/82.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00317637202283194142136/468.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00317637202283194142136/239.dcm&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/notworking/preprocessing.html#check_duplicate"><code>check_duplicate</code></a> shows the indices of the random 10 images chosen above.  By default the train/valid split is 80/20 so the train set has 8 images and the valid set has 2 images.  We can view the the 8 images in the train set and the 2 images in the valid set.</p>

</div>
</div>
</div>
</div>
 

